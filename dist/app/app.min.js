/*!
 * Copyright 2015 itesoft.
 * http://itesoft.com/
 *
 * webapp_seed, v2.6.1
 * A powerful music manager.*/
!function(){angular.module("share.ws.demo",["itesoft","ngRoute","ngSanitize","pascalprecht.translate","ui.bootstrap.dropdown"]).config(["$translateProvider","$translatePartialLoaderProvider","$httpProvider",function(e,r,a){e.registerAvailableLanguageKeys(["en","fr","de"],{en_US:"en",en_GB:"en",fr_FR:"fr","fr-CA":"fr","de-DE":"de"}).determinePreferredLanguage(),e.useLoader("$translatePartialLoader",{urlTemplate:"assets/locale/{lang}/{part}-{lang}.json"}),a.interceptors.push("HttpErrorHandler"),e.useSanitizeValueStrategy()}]).run(["$rootScope","$route",function(e,r){e.$on("$routeChangeSuccess",function(){e.pageTitle=r.current.title})}]),angular.module("share.ws.demo").config(["$routeProvider",function(e){e.when("/home",{templateUrl:"app/features/home/homeView.html",controller:"HomeController",title:"HOME.TITLE"}).otherwise({redirectTo:"/home"})}]),angular.module("share.ws.demo").controller("HomeController",["$scope","FetchDataService","ShareService","CacheRequestService","$rootScope",function(e,r,a,t,o){e.myDefs=[],e.dataSource=[],e.myDefs=[],e.search=function(){a.search(o.searchRequest).then(function(a){e.dataSource=[],e.dataSource=r.extractValues(a.data),e.translations=r.extractTraduction(a.data),e.myDefs=[];var t=e.dataSource[0];for(var o in t)e.myDefs.push({field:o,displayName:null!=e.translations[o]?e.translations[o]:o});e.searchControl={columnDefs:e.myDefs},e.shareGridOptions.columnDefs=e.myDefs})},e.searchControl={columnDefs:e.myDefs},e.shareGridOptions={data:"dataSource",showGridFooter:!0,columnDefs:e.myDefs,onRegisterApi:function(r){e.gridApi=r,e.gridApi.grid.registerRowsProcessor(e.searchControl.multicolumnsFilter,200)}},e.saveState=function(){t.save(o.searchRequest)},e.filter=function(){e.gridApi.grid.refresh()}}]),angular.module("share.ws.demo").directive("queryGrid",function(){return{scope:{searchQueryFields:"="},templateUrl:"app/features/home/queryGrid.html",controller:["$scope",function(e){function r(){var e=this;e.key="",e.operator="",e.value=""}e.searchQueryFields||(e.searchQueryFields=[]),e.addQueryField=function(){e.searchQueryFields.push(new r)},e.removeQueryField=function(r){var a=e.searchQueryFields.indexOf(r);a>-1&&e.searchQueryFields.splice(a,1)}}]}}),angular.module("share.ws.demo").controller("MainController",["$scope","$translate","$rootScope","CacheRequestService",function(e,r,a,t){a.searchRequest=t.load(),e.currentLanguage="fr_FR",e.changeLanguage=function(a){e.currentLanguage=a,r.use(a)}}]),angular.module("share.ws.demo").factory("FetchDataService",function(){function e(e){console.log(e.header.columnsHeader);var r=0,a={};return angular.forEach(e.header.columnsHeader,function(e){a[e.code]=e.desc,r++}),console.log(a),a}function r(e){var r=[];return e.documents.forEach(function(a){var t={};t.docIdxGed=a.docIdxGed;var o=0;angular.forEach(a.fields,function(r){t[e.header.columnsHeader[o].code]=r.translation?r.translation:r.value,o++}),r.push(t)}),r}return{extractTraduction:e,extractValues:r}}),angular.module("share.ws.demo").factory("CacheRequestService",[function(){function e(e){localStorage.setItem(a,angular.toJson(e))}function r(){var e=angular.fromJson(localStorage.getItem(a));return e||(e={}),e.isComplete=function(){return this.serviceUrl&&this.maskID&&this.userID},e}var a="share_ws_saved_request";return{load:r,save:e}}]),angular.module("share.ws.demo").factory("HttpErrorHandler",["$rootScope","$q",function(e,r){return{request:function(r){return e.$error=null,r},requestError:function(e){return r.reject(e)},response:function(e){return e},responseError:function(a){return a.data.status=a.status,e.$error=a.data,r.reject(a)}}}]),angular.module("share.ws.demo").factory("ShareService",["$http","CacheRequestService","$rootScope",function(e,r,a){function t(e){var r=[];return e.forEach(function(e){r+=0==r.length?e.key+e.operator+e.value:";"+e.key+e.operator+e.value}),r}function o(o){r.save(o);var n=t(o.query);return console.log(n),a.lastRequestURL=o.serviceUrl+"?mask="+o.maskID+"&user="+o.userID+(n.length>0?"&query="+n:""),e({method:"GET",url:o.serviceUrl,params:{mask:o.maskID,user:o.userID,query:n}})}return{search:o}}]),angular.module("share.ws.demo").service("TranslationService",["$q","$translate","$translatePartialLoader",function(e,r,a){return function(){return a.addPart("global"),angular.forEach(arguments,function(e){a.addPart(e)}),r.refresh()}}])}();